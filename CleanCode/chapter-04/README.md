### 注释
> 别给糟糕的代码加注释——重新写吧。

——Brian W.Kernighan 与P.J.Plaugher

什么也比不上放置良好的注释来得有用。什么也不会比乱七八糟的注释更有本事搞乱一个模块。什么也不会比陈旧、提供错误信息的注释更有破坏性。
实际上，注释最多就是一种必须的恶。若编程语言足够有表达力，或者我们长于用这些语言表达意图，就不那么需要注释——也根本不需要。
注释的恰当用法是弥补我们在用代码表达意图时遭遇的失败。注释总是一种失败。我们总无法找到不用注释就能表达自我的方法，所以**总要有注释，这并不值得庆贺**。
如果你发现自己需要写注释，再想想看是否有办法翻盘，用代码来表达。每次用代码表达，你都该夸奖一下自己。每次写注释，你都该做个鬼脸，感受自己在表达能力上的失败。
注释存在的时间越久，就离其所描述的代码越远，越来越变得全然错误。原因是，程序员不能坚持维护注释。
程序员应当负责将注释保持在可维护、有关联、精确的高度。但我更主张把力气用在写清除代码上，直接保证无需编写注释。
不准确的注释要比没注释坏得多。它们预期的东西永不能实现。它们设定了无需也不应再遵循的旧规则。
**尽管有时也需要注释，也该花心思尽量减少注释量**。

#### 注释不能美化糟糕的代码
写注释的常见动机之一是糟糕的代码的存在。带有少量猪似的整洁而有表达力的代码，要比带有大量注释的零碎而复杂的代码像样得多。与其花时间编写解释你你搞出来的糟糕的代码的注释，不如花时间清洁那堆糟糕的代码。
#### 用代码来阐述
```
// Check to see if the employee is eligible for full benefits
if((employee.flags & HOURLY_FLAG) & (employee.age>65))
```
还是这个？
```
if(employee.isEligibleForFullBenefits())
```
只要想上那么几秒钟，就能用代码解释你大部分的意图。很多时候，简单到只需要创建一个描述与注释所言同一事物的函数即可。
#### 好注释
有些注释是必须的，值得写的，也是有利的。不过唯一好的注释是你想办法不去写注释。
##### 1. 法律信息
- 版权及著作权声明
是必须和有理由在每个源文件开头注释处放置的内容。
##### 2. 提供信息的注释
例如，解释某个抽象方法的返回值。但更好的方式是尽量利用函数名称表达信息。
##### 3. 对意图的解释
有时，注释不仅童工了有关实现的有用信息，而且还提供了某个决定后后面的意图。
##### 4. 阐释
有时，注释把某些晦涩难明的参数或返回值的意义翻译为某种可读形式。通常，更好的方法是尽量让参数或返回值资深就足够清除；但如果参数或返回值是某个标准库的一部分，或是你不能修改的代码，帮助阐释其含义的代码就会有用。
当然，这也会冒阐释性注释本身就是不正确的风险。所以在写这类注释之前，考虑一下是否还有更好的方法，然后再加倍小心地确认注释正确性。
##### 5. 警示
有时，用于警告其他程序员会出现某种后果的注释也是有用的。
##### 6. TODO注释
TODO是一种程序员认为应该做，但由于某些原因目前还没做的工作。它可能是要提醒删除某个不必要的特性，或者要求他人注意某个问题。它可能是恳请别人取个好名字，或者提示对依赖于某个计划事件的修改。无论TODO的目的如何，它都不是在系统中留下糟糕代码的借口。定期查看，删除不再需要的注释。
##### 7. 放大
注释可以用来放大某种看起来不合理之物的重要性。
##### 8. 公共API中的Javadoc
#### 坏注释
大多数注释都属于此类。通常，坏注释都是糟糕的代码的支撑或借口，或者对错误决策的修正，基本上等于程序员自说自话。
##### 1. 喃喃自语
如果只是因为你觉得应该或者因为过程需要就添加注释，那就是无畏之举。
##### 2. 多余的注释
##### 3. 误导性注释
##### 4. 循轨式注释
##### 5. 日志式注释
有人会在每次编辑代码时，在模块开始处添加一条注释。这类注释就像是一种记录每次修改的日志。
##### 6. 废话注释
与其纠缠于毫无价值的废话注释，程序员应该意识到，他的挫败感可以由改进代码结构而消除。用整理代码的就决心替代创造废话注释，你会发现自己成为更优秀、更快乐的程序员。
##### 7. 能用函数或变量时就别用注释
##### 8. 位置标记
有时，程序员喜欢在源代码中标记某个特别位置。例如，下面这样：
```
// Actions ////////////////////////////
```
把特定函数趸放在这些标记栏下面，多数时候实属无理。鸡零狗碎，理当删除——特别是尾部那一长串无用的斜杠。
如果标记栏不多，就会显而易见。所以，尽量少用标记栏，只在特别有价值的时候用。
##### 9. 括号后面的注释
尽管这对于含有深度嵌套结构的长函数可能有意义，但只会给我们更愿意编写的短小、封装的函数带来混乱。如果你发现自己**想标记右括号，其实应该做的是缩短函数**。
##### 10. 归属与署名
```
/*  Added by Rick   */
```
源代码控制系统非常善于记住是谁在何时添加了什么。没必要用那些小小的签名高脏代码。
##### 11. 注释掉的代码
看看一下来自Apache公共库的代码：
```java
this.bytePos = writeBytes(pngIdBytes, 0);
// hdrPos = bytePos;
writeHeader();
writeResolution();
//dataPos = bytePos;
if(writeImageData()){
    writeEnd();
    this.pngBytes = resizeByteArray(this.pngBytes, this.maxPos);
}else{
    this.pngBytes = null;
}
return this.pngBytes;
```
这两行代码为什么要注释掉？他们重要吗？他们搁在那儿，是为了给未来的修改做提示吗？或者，只是某人在多年以前注释掉、懒得清理的过时玩意？
现在已经拥有优良的源代码控制系统如此之久，这些系统可以为我们记住不要的代码。我们无需再用注释来标记，删掉即可。
##### 12. HTML注释
##### 13. 非本地信息
假如一定要写注释，请确保它描述了离它最近的代码。别在本地注释的上下文环境中给出系统级的信息。
##### 14. 信息过多
避灾注释中添加有趣的历史性话题或者无关的细节描述。
##### 15. 不明显的关系
注释及其描述的代码之间的联系应该显而易见。至少让读者能看着注释和代码，并且能理解注释所谈何物。
##### 16. 函数头
段函数不需要太多描述。为只做一件事的短函数选个好名字，通常要比写函数头注释更好。
##### 17. 非公共代中的Javadoc
##### 18. 范例


